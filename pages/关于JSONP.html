<html>
<head>
  <title>关于JSONP</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="390"/>
<h1>关于JSONP</h1>

<div>
<span><div><span style="font-size: 16px;"><b>1.什么是JSONP</b></span></div><div>JSONP(JSON with Padding)是一个非官方的协议，它允许在服务器端集成Script tags返回至客户端，通过javascript callback的形式实现跨域访问（这仅仅是JSONP简单的实现形式）</div><div>通常在网页里用ajax做异步请求通信的时候，会发现一个问题，我们要请求的文件和当前网页并不在同一个域名下，这就出现的ajax的跨域问题。查了很多资料，其实ajax在设计之初为了保证数据通讯安全，是不允许跨域请求json类型的数据的。</div><div>但是，Web页面上调用js文件时则不受是否跨域的影响（不仅如此，我们还发现凡是拥有&quot;src&quot;这个属性的标签都拥有跨域的能力，比如&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;）。</div><div>聪明的人类想到了通过事先在服务器端程序约定的一个callback(回调函数)，在客户端请求的时候往这个回调函数里传入一个参数，假定叫做abc,然后对方将用这个abc作为名称，包住需要响应的json文件，形如abc(...)，这里...是指json数据类型的数据，这样服务器返回的是一个用abc套子包住的json数据，伪装成javascript文件的模样返回到客户端。</div><div>JSONP也可以说是一种<span style="font-size:14px">非官方跨域数据交互协议。</span></div><div><br/></div><div><span style="font-size: 16px;"><b>2.JSONP的作用</b></span></div><div>由于同源策略的限制，XmlHttpRequest只允许请求当前源（域名、协议、端口）的资源，为了实现跨域请求，可以通过script标签实现跨域请求，然后在服务端输出JSON数据并执行回调函数，从而解决了跨域的数据请求。</div><div><br/></div><div><b><span style="font-size: 16px;">3.如何使用JSONP</span></b></div><div>在客户端声明回调函数之后，客户端通过script标签向服务器跨域请求数据，然后服务端返回相应的数据并动态执行回调函数。</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>     &lt;!DOCTYPE html&gt;</div><div>     &lt;html&gt;</div><div>          &lt;head&gt;</div><div>               &lt;meta charset=&quot;utf-8&quot;&gt;</div><div>               &lt;title&gt;JSONP 实例&lt;/title&gt;</div><div>          &lt;/head&gt;</div><div>          &lt;body&gt;</div><div>               &lt;div id=&quot;divCustomers&quot;&gt;&lt;/div&gt;</div><div>               &lt;script type=&quot;text/javascript&quot;&gt;</div><div>                    function callbackFunction(result, methodName) {</div><div>                         var html = '&lt;ul&gt;';</div><div>                         for(var i = 0; i &lt; result.length; i++) {</div><div>                              html += '&lt;li&gt;' + result[i] + '&lt;/li&gt;';</div><div>                         }</div><div>                         html += '&lt;/ul&gt;';</div><div>                         document.getElementById('divCustomers').innerHTML = html;</div><div>                    }</div><div>               &lt;/script&gt;</div><div>               &lt;script type=&quot;text/javascript&quot; src=&quot;http://www.runoob.com/try/ajax/jsonp.php?jsoncallback=callbackFunction&quot;&gt;&lt;/script&gt;</div><div>          &lt;/body&gt;</div><div>     &lt;/html&gt;</div></div><div><br/></div><div>jquery用JSONP：</div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!DOCTYPE html&gt;</div><div>&lt;html&gt;</div><div>     &lt;head&gt;</div><div>          &lt;meta charset=&quot;utf-8&quot;&gt;</div><div>          &lt;title&gt;JSONP 实例&lt;/title&gt;</div><div>          &lt;script src=&quot;http://cdn.static.runoob.com/libs/jquery/1.8.3/jquery.js&quot;&gt;&lt;/script&gt;</div><div>     &lt;/head&gt;</div><div>     &lt;body&gt;</div><div>          &lt;div id=&quot;divCustomers&quot;&gt;&lt;/div&gt;</div><div>          &lt;script&gt;</div><div>               $.getJSON(&quot;http://www.runoob.com/try/ajax/jsonp.php?jsoncallback=?&quot;, function(data) {</div><div>                    var html = '&lt;ul&gt;';</div><div>                    for(var i = 0; i &lt; data.length; i++) {</div><div>                         html += '&lt;li&gt;' + data[i] + '&lt;/li&gt;';</div><div>                    }</div><div>                    html += '&lt;/ul&gt;';</div><div>                    $('#divCustomers').html(html);</div><div>               });</div><div>          &lt;/script&gt;</div><div>     &lt;/body&gt;</div><div>&lt;/html&gt;</div><div><b>PS:注意,jquey是不支持post方式跨域的.</b></div></div><div><br/></div><div><br/></div><div><b><span style="font-size: 16px;">4.JSONP原理</span></b></div><div>首先在客户端注册一个callback, 然后把callback的名字传给服务器。</div><div><br/></div><div>此时，服务器先生成 json 数据。</div><div><br/></div><div>然后以 javascript 语法的方式，生成一个function , function 名字就是传递上来的参数 jsonp.</div><div><br/></div><div>最后将 json 数据直接以入参的方式，放置到 function 中，这样就生成了一段 js 语法的文档，返回给客户端。</div><div><br/></div><div>客户端浏览器，解析script标签，并执行返回的 javascript 文档，此时数据作为参数，传入到了客户端预先定义好的 callback 函数里.（动态执行回调函数）</div><div><br/></div><div><span style="font-size: 16px;"><b>5.JSONP的优点</b></span></div><ol><li>比XML轻了很多，没有那么多冗余的东西。</li><li>JSON也是具有很好的可读性的，但是通常返回的都是压缩过后的。不像XML这样的浏览器可以直接显示，浏览器对于JSON的格式化的显示就需要借助一些插件了。</li><li>在JavaScript中处理JSON很简单。</li><li>其他语言例如PHP对于JSON的支持也不错。</li></ol><div><br/></div><div><span style="font-size: 16px;"><b>6.JSONP的缺点</b></span></div><ol><li>JSON在服务端语言的支持不像XML那么广泛，不过JSON.org上提供很多语言的库。</li><li>如果你使用eval()来解析的话，会容易出现安全问题。</li></ol><div><br/></div><div><br/></div><div><b><span style="font-size: 16px;"><a name="cautionary_note">主要提示：</a></span></b></div><div>JSONP 是构建 mashup 的强大技术，但不幸的是，它并不是所有跨域通信需求的万灵药。它有一些缺陷，在提交开发资源之前必须认真考虑它们。</div><ol><li>没有关于 JSONP 调用的错误处理。如果动态脚本插入有效，就执行调用；如果无效，就静默失败。失败是没有任何提示的。例如，不能从服务器捕捉到 404 错误，也不能取消或重新开始请求。不过，等待一段时间还没有响应的话，就不用理它了。（未来的 jQuery 版本可能有终止 JSONP 请求的特性）。</li><li>JSONP 的另一个主要缺陷是被不信任的服务使用时会很危险。因为 JSONP 服务返回打包在函数调用中的 JSON 响应，而函数调用是由浏览器执行的，这使宿主 Web 应用程序更容易受到各类攻击。如果打算使用 JSONP 服务，了解它能造成的威胁非常重要。</li></ol></span>
</div></body></html> 