<html>
<head>
  <title>原生JS实现拖拽效果</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="420"/>
<h1>原生JS实现拖拽效果</h1>

<div>
<span><div><p>  如果要设置物体拖拽，那么必须使用三个事件，并且这三个事件的使用顺序不能颠倒。</p><ol><li><b>onmousedown：鼠标按下事件</b></li><li><b>onmousemove：鼠标移动事件</b></li><li><b>onmouseup：鼠标抬起事件</b></li></ol></div><div><br/></div><div>  拖拽的基本原理就是根据鼠标的移动来移动被拖拽的元素。</div><div><br/></div><div>  鼠标的移动也就是x、y坐标的变化；元素的移动就是style.position的 top和left的改变。当然，并不是任何时候移动鼠标都要造成元素的移动，而应该判断鼠标左键的状态是否为按下状态，是否是在可拖拽的元素上按下的。</div><div><br/></div><div>  基本思路如下：</div><div>     拖拽状态 = 0</div><div>     鼠标在元素上按下的时候{      </div><div>         拖拽状态 = 1      </div><div>         记录下鼠标的x和y坐标      </div><div>         记录下元素的x和y坐标      </div><div>        }   </div><div>      鼠标在元素上移动的时候{      </div><div>         如果拖拽状态是0就什么也不做 </div><div>         如果拖拽状态是1，那么      </div><div>         元素y = 现在鼠标y - 原来鼠标y + 原来元素y      </div><div>         元素x = 现在鼠标x - 原来鼠标x + 原来元素x      </div><div>         }       </div><div>      鼠标在任何时候放开的时候{      </div><div>         拖拽状态 = 0      </div><div>     }  </div><div> </div><div><br/></div><div><br/></div><div><strong>部分实例代码：</strong></div><div><b><br/></b></div><div><span style="color: rgb(26, 144, 185);"><b>HTML部分</b></span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">&lt;div class=&quot;calculator&quot; id=&quot;drag&quot;&gt;**********&lt;/div&gt;</span></span></span></div></div><div><br/></div><div><b><span style="color:#0070C0">CSS</span><span style="color:#0070C0">部分</span></b></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">.calculator {</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    position: absolute; /*设置绝对定位，脱离文档流，便于拖拽*/</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    display: block;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    width: 218px;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    height: 280px;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    cursor: move;   /*鼠标呈拖拽状*/</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">}</span></span></span> </div></div><div><br/></div><div><b><span style="color:#0070C0">js部分</span></b></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>window.onload = function() {</div><div>    //拖拽功能(主要是触发三个事件：onmousedown\onmousemove\onmouseup)</div><div>    var drag = document.getElementById('drag');</div><div><br/></div><div>    //点击某物体时，用drag对象即可，move和up是全局区域，也就是整个文档通用，应该使用document对象而不是drag对象(否则，采用drag对象时物体只能往右方或下方移动)</div><div>    drag.onmousedown = function(e) {</div><div>        var e = e || window.event; //兼容ie浏览器</div><div>        var diffX = e.clientX - drag.offsetLeft; //鼠标点击物体那一刻相对于物体左侧边框的距离=点击时的位置相对于浏览器最左边的距离-物体左边框相对于浏览器最左边的距离</div><div>        var diffY = e.clientY - drag.offsetTop;</div><div><br/></div><div>        /*低版本ie bug:物体被拖出浏览器可是窗口外部时，还会出现滚动条，</div><div>            解决方法是采用ie浏览器独有的2个方法setCapture()\releaseCapture(),这两个方法，</div><div>            可以让鼠标滑动到浏览器外部也可以捕获到事件，而我们的bug就是当鼠标移出浏览器的时候，</div><div>            限制超过的功能就失效了。用这个方法，即可解决这个问题。注：这两个方法用于onmousedown和onmouseup中*/</div><div><br/></div><div>        if(typeof drag.setCapture!='undefined'){</div><div>            drag.setCapture();</div><div>        }</div><div><br/></div><div>        document.onmousemove = function(e) {</div><div>            var e = e || window.event; //兼容ie浏览器</div><div>            var left=e.clientX-diffX;</div><div>            var top=e.clientY-diffY;</div><div><br/></div><div>            //控制拖拽物体的范围只能在浏览器视窗内，不允许出现滚动条</div><div>            if(left&lt;0){</div><div>                left=0;</div><div>            }else if(left &gt;window.innerWidth-drag.offsetWidth){</div><div>                left = window.innerWidth-drag.offsetWidth;</div><div>            }</div><div>            if(top&lt;0){</div><div>                top=0;</div><div>            }else if(top &gt;window.innerHeight-drag.offsetHeight){</div><div>                top = window.innerHeight-drag.offsetHeight;</div><div>            }</div><div><br/></div><div>            //移动时重新得到物体的距离，解决拖动时出现晃动的现象</div><div>            drag.style.left = left+ 'px';</div><div>            drag.style.top = top + 'px';</div><div>        };</div><div><br/></div><div>        document.onmouseup = function(e) { //当鼠标弹起来的时候不再移动</div><div>            this.onmousemove = null;</div><div>            this.onmouseup = null; //预防鼠标弹起来后还会循环（即预防鼠标放上去的时候还会移动）</div><div><br/></div><div>            //修复低版本ie bug</div><div>            if(typeof drag.releaseCapture!='undefined'){</div><div>                drag.releaseCapture();</div><div>            }</div><div>        };</div><div>    };</div><div>};</div></div><div><br/></div></span>
</div></body></html> 